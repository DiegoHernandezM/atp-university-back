import{r as a,W as R,j as e,R as L,f as z,Y as M}from"./app-Dkk80x56.js";import{r as s}from"./index-CAoa_Lfd.js";import{F as _,A as I}from"./AuthenticatedLayout-BGV4sc3p.js";import{I as $}from"./InputError-B4DMRjhS.js";import{F as H,a as P}from"./TrashIcon-CfRVNdQ-.js";import{F as O,a as Z}from"./PlusIcon-DqfJkVix.js";function W({title:m,titleId:r,...l},d){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":r},l),m?a.createElement("title",{id:r},m):null,a.createElement("path",{fillRule:"evenodd",d:"M9.53 2.47a.75.75 0 0 1 0 1.06L4.81 8.25H15a6.75 6.75 0 0 1 0 13.5h-3a.75.75 0 0 1 0-1.5h3a5.25 5.25 0 1 0 0-10.5H4.81l4.72 4.72a.75.75 0 1 1-1.06 1.06l-6-6a.75.75 0 0 1 0-1.06l6-6a.75.75 0 0 1 1.06 0Z",clipRule:"evenodd"}))}const q=a.forwardRef(W);function V({title:m,titleId:r,...l},d){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":r},l),m?a.createElement("title",{id:r},m):null,a.createElement("path",{fillRule:"evenodd",d:"M4.125 3C3.089 3 2.25 3.84 2.25 4.875V18a3 3 0 0 0 3 3h15a3 3 0 0 1-3-3V4.875C17.25 3.839 16.41 3 15.375 3H4.125ZM12 9.75a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H12Zm-.75-2.25a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5H12a.75.75 0 0 1-.75-.75ZM6 12.75a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5H6Zm-.75 3.75a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5H6a.75.75 0 0 1-.75-.75ZM6 6.75a.75.75 0 0 0-.75.75v3c0 .414.336.75.75.75h3a.75.75 0 0 0 .75-.75v-3A.75.75 0 0 0 9 6.75H6Z",clipRule:"evenodd"}),a.createElement("path",{d:"M18.75 6.75h1.875c.621 0 1.125.504 1.125 1.125V18a1.5 1.5 0 0 1-3 0V6.75Z"}))}const U=a.forwardRef(V),Y=({open:m,onClose:r,onSuccess:l,currentLesson:d,subject:f})=>{const u=!!d,{data:x,setData:v,post:N,reset:C,errors:h,put:g}=R({subject:f.id,title:"",description:""}),[w,j]=a.useState(!1);a.useEffect(()=>{u?v({subject:f.id,title:d.title,description:d.description}):C()},[d,u]);const b=y=>{y.preventDefault(),j(!0),u?g(route("lessons.update",d.id),{...x,onSuccess:()=>{j(!1),l("Leccion actualizada correctamente."),r()},onError:o=>{console.error(o),j(!1)}}):N(route("lessons.store"),{onSuccess:()=>{j(!1),C(),l("Leccción creadaa correctamente."),r()},onError:o=>{console.error(o),j(!1)}})};return e.jsx(L.Fragment,{children:e.jsxs(s.Drawer,{placement:"right",open:m,onClose:r,className:"p-4",size:500,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("h3",{className:"text-lg font-bold",children:u?"Editar Lección":"Agregar Nueva Lección"}),e.jsx(s.IconButton,{variant:"text",color:"blue-gray",onClick:r,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 h-[calc(100vh-100px)] overflow-y-auto",children:e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(s.Input,{id:"title",name:"title",value:x.title,type:"text",size:"lg",label:"Titulo",placeholder:"Titulo",className:"!border-t-blue-gray-200 focus:!border-t-gray-900",labelProps:{className:"before:content-none after:content-none"},onChange:y=>v("title",y.target.value)}),h.name&&e.jsx($,{message:h.title,className:"mt-2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(s.Textarea,{id:"description",name:"description",value:x.description,size:"lg",placeholder:"Descripción",className:"!border-t-blue-gray-200 focus:!border-t-gray-900",labelProps:{className:"before:content-none after:content-none"},onChange:y=>v("description",y.target.value)}),h.description&&e.jsx($,{message:h.description,className:"mt-2"})]}),e.jsx(s.Button,{type:"submit",color:"blue-gray",fullWidth:!0,disabled:w,children:w?"Enviando...":u?"Actualizar Lección":"Crear Lección"})]})})]})})};function G({open:m,onClose:r,currentLesson:l,successMesage:d,subjectId:f}){const[u,x]=a.useState({}),{setData:v,post:N,reset:C}=R(),[h,g]=a.useState([]);a.useState(!1),a.useEffect(()=>{l!=null&&l.resources?(v(l.resources),g(l.resources)):g([{title:"",type:"",file:null}])},[l]);const w=()=>{g([...h,{title:"",type:"",file:null}])},j=o=>{const t=h.filter((i,n)=>n!==o);g(t)},b=(o,t,i)=>{const n=[...h];i&&i.target?n[o][t]=i.target.value:n[o][t]=i,g(n)},y=()=>{let o=!1,t={};if(h.forEach((n,p)=>{n.title||(o=!0,t[`title_${p}`]="El título es requerido"),n.type||(o=!0,t[`type_${p}`]="El tipo es requerido"),!n.id&&!n.file&&(o=!0,t[`file_${p}`]="El archivo es requerido para nuevos recursos")}),o){x(t);return}const i=new FormData;i.append("lesson_id",l.id),h.forEach((n,p)=>{i.append(`resources[${p}][id]`,n.id||""),i.append(`resources[${p}][title]`,n.title),i.append(`resources[${p}][type]`,n.type),n.file&&i.append(`resources[${p}][file]`,n.file)}),z.post("/resources/store/",i,{headers:{"Content-Type":"multipart/form-data"}}).then(n=>{console.log("Formulario enviado con éxito"),d("Recursos de lección guardados correctamente"),C(),r(),setTimeout(()=>{window.location.href=`/lessons/${f}`},1e3)}).catch(n=>{console.error(n)})};return e.jsxs(s.Dialog,{size:"xxl",open:m,handler:r,className:"h-screen p-4",children:[e.jsxs(s.DialogHeader,{className:"relative m-0 block",children:[e.jsx(s.Typography,{variant:"h4",color:"blue-gray",children:"Administra el contenido de la lección"}),e.jsx(s.Typography,{className:"mt-1 font-normal text-gray-600",children:`Lección: ${l==null?void 0:l.title}`}),e.jsx(s.IconButton,{size:"sm",variant:"text",className:"!absolute right-3.5 top-3.5",onClick:r,children:e.jsx(_,{className:"h-4 w-4 stroke-2"})})]}),e.jsx(s.DialogBody,{className:"flex flex-col h-full space-y-4 pb-6 overflow-y-scroll",children:e.jsx("div",{className:"flex-1 overflow-y-auto space-y-4 h-1/2",children:h.map((o,t)=>e.jsxs(s.Card,{className:"relative",children:[e.jsxs(s.CardBody,{children:[e.jsx("input",{type:"hidden",name:`resources[${t}][id]`,value:o.id||""}),e.jsxs("div",{children:[e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"mb-2 text-left font-medium",children:"Título"}),e.jsx(s.Input,{color:"gray",size:"lg",placeholder:"Ingresa el título",name:`resources[${t}][title]`,value:o.title,onChange:i=>b(t,"title",i.target.value),className:"placeholder:opacity-100 focus:!border-t-gray-900",containerProps:{className:"!min-w-full"},labelProps:{className:"hidden"}}),u[`title_${t}`]&&e.jsx("span",{className:"text-red-500 text-sm",children:u[`title_${t}`]})]}),e.jsxs("div",{children:[e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"mb-2 text-left font-medium",children:"Tipo"}),e.jsxs("select",{name:`resources[${t}][type]`,value:o.type||"",onChange:i=>b(t,"type",i.target.value),className:"!w-full !border-[1.5px] !border-blue-gray-200/90 !border-t-blue-gray-200/90 bg-white text-gray-800 ring-4 ring-transparent placeholder:text-gray-600 focus:!border-primary focus:!border-t-blue-gray-900 group-hover:!border-primary",children:[e.jsx("option",{value:"",children:"Seleccione"}),e.jsx("option",{value:"pdf",children:"PDF"}),e.jsx("option",{value:"video",children:"Video"})]}),u[`type_${t}`]&&e.jsx("span",{className:"text-red-500 text-sm",children:u[`type_${t}`]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"mb-2 text-left font-medium",children:"Archivo"}),e.jsx("input",{type:"file",name:`resources[${t}][file]`,onChange:i=>b(t,"file",i.target.files[0])}),!o.id&&u[`file_${t}`]&&e.jsx("span",{className:"text-red-500 text-sm",children:u[`file_${t}`]})]})})]}),e.jsx(s.CardFooter,{children:e.jsx(s.Button,{variant:"text",size:"sm",color:"red",onClick:()=>j(t),children:"Eliminar"})})]},t))})}),e.jsxs(s.DialogFooter,{className:"sticky bottom-0 flex justify-between space-x-2 bg-white py-4",children:[e.jsxs(s.Button,{size:"sm",variant:"text",className:"flex items-center gap-2",onClick:w,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"h-4 w-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.75v14.5m7.25-7.25h-14.5"})}),"Agregar contenido"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(s.Button,{onClick:y,children:"Actualizar"}),e.jsx(s.Button,{onClick:r,children:"Cancelar"})]})]})]})}const J=({lessons:m,subject:r})=>{const[l,d]=a.useState(""),[f,u]=a.useState(m),[x,v]=a.useState(1),[N]=a.useState(5),[C,h]=a.useState(!1),[g,w]=a.useState(null),[j,b]=a.useState(null),[y,o]=a.useState(!1);a.useEffect(()=>{const c=m.filter(k=>k.title.toLowerCase().includes(l.toLowerCase()));u(c)},[l,m]);const t=x*N,i=t-N,n=f.slice(i,t),p=c=>v(c),S=()=>h(!0),T=()=>{b(null),h(!1)},E=c=>{w(c),setTimeout(()=>w(null),3e3)},B=c=>{b(c),h(!0)},F=c=>{b(c),o(!0)},D=()=>{b(null),o(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(G,{open:y,onClose:D,currentLesson:j,successMesage:E,subjectId:r.id}),g&&e.jsx(s.Alert,{color:"green",children:g}),e.jsxs(s.Card,{className:"h-full w-full",children:[e.jsx(s.CardHeader,{floated:!1,shadow:!1,className:"rounded-none",children:e.jsxs("div",{className:"mb-4 flex flex-col justify-between gap-8 md:flex-row md:items-center",children:[e.jsxs("div",{children:[e.jsx(s.Typography,{variant:"h5",color:"blue-gray",children:`Lista de lecciones de la materia: ${r.title}`}),e.jsx(s.Typography,{color:"gray",className:"mt-1 font-normal",children:"Administra tus lecciones a continuación"})]}),e.jsxs("div",{className:"flex w-full shrink-0 gap-2 md:w-max",children:[e.jsx("div",{className:"w-full md:w-72",children:e.jsx(s.Input,{label:"Buscar nombre",icon:e.jsx(H,{className:"h-5 w-5"}),value:l,onChange:c=>d(c.target.value)})}),e.jsxs(s.Button,{className:"flex items-center gap-3",size:"sm",onClick:S,children:[e.jsx(O,{strokeWidth:2,className:"h-4 w-4"})," Nuevo"]}),e.jsxs(s.Button,{className:"flex items-center gap-3",size:"sm",onClick:()=>window.location.href=route("subjects.index"),children:[e.jsx(q,{strokeWidth:2,className:"h-4 w-4"})," Regresar"]})]})]})}),e.jsx(s.CardBody,{className:"overflow-scroll px-0",children:e.jsxs("table",{className:"w-full min-w-max table-auto text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-4",children:"Materia"}),e.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-4",children:"Titulo"}),e.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-4",children:"Descripción"}),e.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-4",children:"Acciones"})]})}),e.jsx("tbody",{children:n.map((c,k)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(s.Typography,{className:"font-bold",children:r.title?r.title:"Sin título"})})}),e.jsx("td",{className:"p-4",children:c.title}),e.jsx("td",{className:"p-4",children:c.description}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(s.Tooltip,{content:"Contenido",children:e.jsx(s.IconButton,{variant:"text",onClick:()=>F(c),children:e.jsx(U,{className:"h-4 w-4"})})}),e.jsx(s.Tooltip,{content:"Editar",children:e.jsx(s.IconButton,{variant:"text",onClick:()=>B(c),children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsxs("form",{method:"POST",action:route("lessons.destroy",c.id),onSubmit:A=>{window.confirm(`¿Estás seguro que deseas eliminar a ${c.title}?`)||A.preventDefault()},children:[e.jsx("input",{type:"hidden",name:"_token",value:document.querySelector('meta[name="csrf-token"]').getAttribute("content")}),e.jsx("input",{type:"hidden",name:"_method",value:"DELETE"}),e.jsx(s.Tooltip,{content:"Eliminar",children:e.jsx(s.IconButton,{type:"submit",variant:"text",color:"red",children:e.jsx(P,{className:"h-4 w-4"})})})]})]})})]},c.id))})]})}),e.jsxs(s.CardFooter,{className:"flex items-center justify-between border-t border-blue-gray-50 p-4",children:[e.jsx(s.Button,{variant:"outlined",size:"sm",onClick:()=>p(x-1),disabled:x===1,children:"Anterior"}),e.jsx(s.Button,{variant:"outlined",size:"sm",onClick:()=>p(x+1),disabled:x===Math.ceil(f.length/N),children:"Siguiente"})]})]}),e.jsx(Y,{open:C,onClose:T,onSuccess:E,currentLesson:j,subject:r})]})},K=J;function re({auth:m,lessons:r,subject:l,...d}){var u;const f=(u=d==null?void 0:d.flash)==null?void 0:u.success;return e.jsxs(I,{user:m.user,roles:m.roles,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Lecciones"}),children:[e.jsx(M,{title:"Lessons"}),e.jsx("div",{children:f&&e.jsx(s.Alert,{color:"green",children:f})}),e.jsx("div",{className:"mt-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:e.jsx(K,{lessons:r,subject:l})})})]})}export{re as default};
