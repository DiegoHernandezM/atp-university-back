import{W as F,r as u,j as e,R as z,Y as I}from"./app-Dkk80x56.js";import{r as s}from"./index-CAoa_Lfd.js";import{A as R}from"./AuthenticatedLayout-BGV4sc3p.js";import{I as C}from"./InputError-B4DMRjhS.js";import{F as L,a as M}from"./TrashIcon-CfRVNdQ-.js";import{F as O,a as W}from"./PlusIcon-DqfJkVix.js";import{F as _,a as q,b as H}from"./XCircleIcon-DVdkaKpr.js";const G=({open:p,onClose:x,onSuccess:j,currentCourse:t})=>{const d=!!t,{data:a,setData:n,post:w,reset:g,errors:i}=F({title:"",description:"",price:"",status:"",cover:null,file:null}),[b,f]=u.useState(!1);u.useEffect(()=>{d?n({title:t.title,description:t.description,price:t.price,status:t.status,cover:null,file:null}):g()},[t,d]);const v=l=>{l.preventDefault(),f(!0);const c=new FormData;c.append("title",a.title),c.append("status",a.status),c.append("description",a.description),c.append("price",a.price),a.file&&c.append("file",a.file),a.cover&&c.append("cover",a.cover),d?w(route("courses.update",t.id),{data:c,onSuccess:()=>{f(!1),g(),j("Curso actualizado correctamente."),x()},onError:N=>{console.error(N),f(!1)}}):w(route("courses.store"),{data:c,onSuccess:()=>{f(!1),g(),j("Curso creado correctamente."),x()},onError:N=>{console.error(N),f(!1)}})};return e.jsx(z.Fragment,{children:e.jsxs(s.Drawer,{placement:"right",open:p,onClose:x,className:"p-4",size:500,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("h3",{className:"text-lg font-bold",children:d?"Editar Curso":"Agregar Nuevo Curso"}),e.jsx(s.IconButton,{variant:"text",color:"blue-gray",onClick:x,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 h-[calc(100vh-100px)] overflow-y-auto",children:e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(s.Input,{id:"title",name:"title",value:a.title,type:"text",size:"lg",label:"Nombre",placeholder:"Nombre",className:"!border-t-blue-gray-200 focus:!border-t-gray-900",labelProps:{className:"before:content-none after:content-none"},onChange:l=>n("title",l.target.value)}),i.title&&e.jsx(C,{message:i.title,className:"mt-2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(s.Textarea,{id:"description",name:"description",value:a.description,size:"lg",placeholder:"Descripción",className:"!border-t-blue-gray-200 focus:!border-t-gray-900",labelProps:{className:"before:content-none after:content-none"},onChange:l=>n("description",l.target.value)}),i.description&&e.jsx(C,{message:i.description,className:"mt-2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(s.Input,{id:"price",name:"price",value:a.price,type:"text",size:"lg",label:"Precio ($)",placeholder:"Precio ($)",className:"!border-t-blue-gray-200 focus:!border-t-gray-900",labelProps:{className:"before:content-none after:content-none"},onChange:l=>n("price",l.target.value)}),i.price&&e.jsx(C,{message:i.price,className:"mt-2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"cover",className:"block text-sm font-medium text-gray-700 mb-2",children:"Agrega una imagen para portada del curso (.jpg)"}),e.jsx("input",{type:"file",id:"cover",name:"cover",accept:".jpg,.jpeg",onChange:l=>n("cover",l.target.files[0])}),i.cover&&e.jsx(C,{message:i.cover,className:"mt-2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"file",className:"block text-sm font-medium text-gray-700 mb-2",children:"Agrega video o PDF de presentación para el curso"}),e.jsx("input",{type:"file",id:"file",name:"file",accept:".pdf,.mp4",onChange:l=>n("file",l.target.files[0])}),i.file&&e.jsx(C,{message:i.file,className:"mt-2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700",children:"Estado"}),e.jsxs("select",{id:"status",name:"status",value:a.status,onChange:l=>n("status",l.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-blue-gray-200 focus:border-gray-900 focus:outline-none focus:ring-indigo-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"",children:"Seleccione"}),e.jsx("option",{value:"active",children:"Activo"}),e.jsx("option",{value:"inactive",children:"Inactivo"})]}),i.status&&e.jsx(C,{message:i.status,className:"mt-2"})]}),e.jsx(s.Button,{type:"submit",color:"blue-gray",fullWidth:!0,disabled:b,children:b?"Enviando...":d?"Actualizar Curso":"Crear Curso"})]})})]})})};function Y({open:p,onClose:x,handleMessage:j,course:t,subjects:d}){const[a,n]=u.useState([]),{data:w,setData:g,post:i,reset:b,errors:f}=F({course_id:t==null?void 0:t.id,aSubjects:[]});u.useEffect(()=>{if(t!=null&&t.subjects){const o=t.subjects.map(h=>h.id);n(o),g({course_id:t==null?void 0:t.id,aSubjects:o})}},[t]);const v=o=>{const h=a.includes(o)?a.filter(m=>m!==o):[...a,o];n(h),g("aSubjects",h)},l=()=>{i(route("courses.subjects"),{onSuccess:()=>{b(),j("Materias actualizadas correctamente"),x()},onError:o=>{console.error(o)}})},N=((o,h=7)=>{const m=[];for(let y=0;y<o.length;y+=h)m.push(o.slice(y,y+h));return m})(d);return e.jsxs(s.Dialog,{open:p,handler:x,size:"lg",children:[e.jsx(s.DialogHeader,{children:`Administra las materias que pertenecerán al curso: ${t==null?void 0:t.title}`}),e.jsx(s.DialogBody,{children:e.jsx("div",{className:"grid grid-cols-3 gap-4",children:N.map((o,h)=>e.jsx("div",{className:"flex flex-col space-y-2",children:o.map(m=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(s.Checkbox,{id:`subject-${m.id}`,checked:a.includes(m.id),onChange:()=>v(m.id)}),e.jsx("label",{htmlFor:`subject-${m.id}`,className:"ml-2",children:m.title})]},m.id))},h))})}),e.jsxs(s.DialogFooter,{children:[e.jsx(s.Button,{variant:"text",color:"red",onClick:x,className:"mr-1",children:e.jsx("span",{children:"Cancelar"})}),e.jsx(s.Button,{variant:"gradient",color:"green",onClick:l,children:e.jsx("span",{children:"Guardar"})})]})]})}const J=({courses:p,subjects:x})=>{const[j,t]=u.useState(""),[d,a]=u.useState(p),[n,w]=u.useState(1),[g]=u.useState(5),[i,b]=u.useState(!1),[f,v]=u.useState(null),[l,c]=u.useState(null),[N,o]=u.useState(!1);u.useEffect(()=>{const r=p.filter(k=>k.title.toLowerCase().includes(j.toLowerCase()));a(r)},[j,p]);const h=n*g,m=h-g,y=d.slice(m,h),S=r=>w(r),D=()=>b(!0),E=()=>{c(null),b(!1)},A=r=>{v(r),setTimeout(()=>v(null),3e3)},B=r=>{c(r),b(!0)},T=()=>{c(null),o(!1)},$=r=>{console.log("sntro"),v(r),setTimeout(()=>v(null),3e3)};return e.jsxs(e.Fragment,{children:[f&&e.jsx(s.Alert,{color:"green",children:f}),e.jsxs(s.Card,{className:"h-full w-full",children:[e.jsx(s.CardHeader,{floated:!1,shadow:!1,className:"rounded-none",children:e.jsxs("div",{className:"mb-4 flex flex-col justify-between gap-8 md:flex-row md:items-center",children:[e.jsxs("div",{children:[e.jsx(s.Typography,{variant:"h5",color:"blue-gray",children:"Lista de Cursos"}),e.jsx(s.Typography,{color:"gray",className:"mt-1 font-normal",children:"Administra tus cursos a continuación"})]}),e.jsxs("div",{className:"flex w-full shrink-0 gap-2 md:w-max",children:[e.jsx("div",{className:"w-full md:w-72",children:e.jsx(s.Input,{label:"Buscar nombre",icon:e.jsx(L,{className:"h-5 w-5"}),value:j,onChange:r=>t(r.target.value)})}),e.jsxs(s.Button,{className:"flex items-center gap-3",size:"sm",onClick:D,children:[e.jsx(O,{strokeWidth:2,className:"h-4 w-4"})," Nuevo"]})]})]})}),e.jsx(s.CardBody,{className:"overflow-scroll px-0",children:e.jsxs("table",{className:"w-full min-w-max table-auto text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-4",children:"Título"}),e.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-4",children:"Estado"}),e.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-4",children:"Precio ($)"}),e.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-4",children:"Acciones"})]})}),e.jsx("tbody",{children:y.map((r,k)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(s.Typography,{className:"font-bold",children:r.title})})}),e.jsx("td",{className:"p-4",children:r.status==="active"?e.jsx(_,{className:"h-4 w-4 text-green-500"}):e.jsx(q,{className:"h-4 w-4 text-red-500"})}),e.jsx("td",{className:"p-4",children:r.price}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(s.Tooltip,{content:"Editar",children:e.jsx(s.IconButton,{variant:"text",onClick:()=>B(r),children:e.jsx(W,{className:"h-4 w-4"})})}),e.jsx(s.Tooltip,{content:"Materias",children:e.jsx(s.IconButton,{variant:"text",onClick:()=>{c(r),o(!0)},children:e.jsx(H,{className:"h-4 w-4"})})}),e.jsxs("form",{method:"POST",action:route("courses.destroy",r.id),onSubmit:P=>{window.confirm(`¿Estás seguro que deseas eliminar el curso: ${r.title}?`)||P.preventDefault()},children:[e.jsx("input",{type:"hidden",name:"_token",value:document.querySelector('meta[name="csrf-token"]').getAttribute("content")}),e.jsx("input",{type:"hidden",name:"_method",value:"DELETE"}),e.jsx(s.Tooltip,{content:"Eliminar",children:e.jsx(s.IconButton,{type:"submit",variant:"text",color:"red",children:e.jsx(M,{className:"h-4 w-4"})})})]})]})})]},r.id))})]})}),e.jsxs(s.CardFooter,{className:"flex items-center justify-between border-t border-blue-gray-50 p-4",children:[e.jsx(s.Button,{variant:"outlined",size:"sm",onClick:()=>S(n-1),disabled:n===1,children:"Anterior"}),e.jsx(s.Button,{variant:"outlined",size:"sm",onClick:()=>S(n+1),disabled:n===Math.ceil(d.length/g),children:"Siguiente"})]})]}),e.jsx(G,{open:i,onClose:E,onSuccess:A,currentCourse:l}),e.jsx(Y,{open:N,onClose:T,handleMessage:$,course:l,subjects:x})]})},K=J;function te({auth:p,courses:x,subjects:j,...t}){var a;const d=(a=t==null?void 0:t.flash)==null?void 0:a.success;return e.jsxs(R,{user:p.user,roles:p.roles,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Cursos"}),children:[e.jsx(I,{title:"Courses"}),e.jsx("div",{children:d&&e.jsx(s.Alert,{color:"green",children:d})}),e.jsx("div",{className:"mt-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:e.jsx(K,{courses:x,subjects:j})})})]})}export{te as default};
