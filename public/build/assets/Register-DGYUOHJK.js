import{r as i,R as M,j as a,W as se,Y as oe}from"./app-Dkk80x56.js";import{G as ie}from"./GuestLayout-BChk0kJY.js";import{I as B}from"./InputError-B4DMRjhS.js";import{I as L}from"./InputLabel-DRh5EMDY.js";import{P as ce}from"./PrimaryButton-F1MKKNq9.js";import{T as U}from"./TextInput-CLGQmMFw.js";import{r as S}from"./index-CAoa_Lfd.js";function le({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"}))}const ue=i.forwardRef(le);function de({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const pe=i.forwardRef(de);/*!
 * react-paypal-js v8.7.0 (2024-09-16T17:52:54.237Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var g;(function(e){e.INITIAL="initial",e.PENDING="pending",e.REJECTED="rejected",e.RESOLVED="resolved"})(g||(g={}));var w;(function(e){e.LOADING_STATUS="setLoadingStatus",e.RESET_OPTIONS="resetOptions",e.SET_BRAINTREE_INSTANCE="braintreeInstance"})(w||(w={}));var V;(function(e){e.NUMBER="number",e.CVV="cvv",e.EXPIRATION_DATE="expirationDate",e.EXPIRATION_MONTH="expirationMonth",e.EXPIRATION_YEAR="expirationYear",e.POSTAL_CODE="postalCode"})(V||(V={}));var f=function(){return f=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},f.apply(this,arguments)};function z(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function X(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,s;n<o;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}var D="data-react-paypal-script-id",R={DATA_CLIENT_TOKEN:"dataClientToken",DATA_JS_SDK_LIBRARY:"dataJsSdkLibrary",DATA_LIBRARY_VALUE:"react-paypal-js",DATA_NAMESPACE:"dataNamespace",DATA_SDK_INTEGRATION_SOURCE:"dataSdkIntegrationSource",DATA_USER_ID_TOKEN:"dataUserIdToken"},fe="Failed to load the PayPal JS SDK script.",Y="paypal",me="usePayPalScriptReducer must be used within a PayPalScriptProvider";function ve(e){return e===void 0&&(e=Y),window[e]}function he(e){for(var t="",r=0;r<e.length;r++){var n=e[r].charCodeAt(0)*r;e[r+1]&&(n+=e[r+1].charCodeAt(0)*(r-1)),t+=String.fromCharCode(97+Math.abs(n)%26)}return t}function ge(e){var t=e.reactComponentName,r=e.sdkComponentKey,n=e.sdkRequestedComponents,o=n===void 0?"":n,s=e.sdkDataNamespace,u=s===void 0?Y:s,d=r.charAt(0).toUpperCase().concat(r.substring(1)),c="Unable to render <".concat(t," /> because window.").concat(u,".").concat(d," is undefined."),p=typeof o=="string"?o:o.join(",");if(!p.includes(r)){var m=[p,r].filter(Boolean).join();c+=`
To fix the issue, add '`.concat(r,"' to the list of components passed to the parent PayPalScriptProvider:")+"\n`<PayPalScriptProvider options={{ components: '".concat(m,"'}}>`.")}return c}function Q(e){var t=e,r=D;t[r];var n=z(t,[r+""]);return"react-paypal-js-".concat(he(JSON.stringify(n)))}function xe(e){var t=self.document.querySelector("script[".concat(D,'="').concat(e,'"]'));t!=null&&t.parentNode&&t.parentNode.removeChild(t)}function Se(e,t){var r,n;switch(t.type){case w.LOADING_STATUS:return typeof t.value=="object"?f(f({},e),{loadingStatus:t.value.state,loadingStatusErrorMessage:t.value.message}):f(f({},e),{loadingStatus:t.value});case w.RESET_OPTIONS:return xe(e.options[D]),f(f({},e),{loadingStatus:g.PENDING,options:f(f((r={},r[R.DATA_SDK_INTEGRATION_SOURCE]=R.DATA_LIBRARY_VALUE,r),t.value),(n={},n[D]="".concat(Q(t.value)),n))});case w.SET_BRAINTREE_INSTANCE:return f(f({},e),{braintreePayPalCheckoutInstance:t.value});default:return e}}var H=i.createContext(null);function be(e){if(typeof(e==null?void 0:e.dispatch)=="function"&&e.dispatch.length!==0)return e;throw new Error(me)}function ee(){var e=be(i.useContext(H)),t=f(f({},e),{isInitial:e.loadingStatus===g.INITIAL,isPending:e.loadingStatus===g.PENDING,isResolved:e.loadingStatus===g.RESOLVED,isRejected:e.loadingStatus===g.REJECTED});return[t,e.dispatch]}i.createContext({});var W=function(e){var t,r=e.className,n=r===void 0?"":r,o=e.disabled,s=o===void 0?!1:o,u=e.children,d=e.forceReRender,c=d===void 0?[]:d,p=z(e,["className","disabled","children","forceReRender"]),m=s?{opacity:.38}:{},x="".concat(n," ").concat(s?"paypal-buttons-disabled":"").trim(),v=i.useRef(null),b=i.useRef(null),y=ee()[0],E=y.isResolved,h=y.options,_=i.useState(null),N=_[0],F=_[1],P=i.useState(!0),q=P[0],G=P[1],k=i.useState(null),I=k[1];function j(){b.current!==null&&b.current.close().catch(function(){})}return!((t=b.current)===null||t===void 0)&&t.updateProps&&b.current.updateProps({message:p.message}),i.useEffect(function(){if(E===!1)return j;var T=ve(h.dataNamespace);if(T===void 0||T.Buttons===void 0)return I(function(){throw new Error(ge({reactComponentName:W.displayName,sdkComponentKey:"buttons",sdkRequestedComponents:h.components,sdkDataNamespace:h[R.DATA_NAMESPACE]}))}),j;var K=function(A,O){F(O),typeof p.onInit=="function"&&p.onInit(A,O)};try{b.current=T.Buttons(f(f({},p),{onInit:K}))}catch(A){return I(function(){throw new Error("Failed to render <PayPalButtons /> component. Failed to initialize:  ".concat(A))})}return b.current.isEligible()===!1?(G(!1),j):(v.current&&b.current.render(v.current).catch(function(A){v.current===null||v.current.children.length===0||I(function(){throw new Error("Failed to render <PayPalButtons /> component. ".concat(A))})}),j)},X(X([E],c,!0),[p.fundingSource],!1)),i.useEffect(function(){N!==null&&(s===!0?N.disable().catch(function(){}):N.enable().catch(function(){}))},[s,N]),M.createElement(M.Fragment,null,q?M.createElement("div",{ref:v,style:m,className:x}):u)};W.displayName="PayPalButtons";function ye(e,t){var r=document.querySelector('script[src="'.concat(e,'"]'));if(r===null)return null;var n=te(e,t),o=r.cloneNode();if(delete o.dataset.uidAuto,Object.keys(o.dataset).length!==Object.keys(n.dataset).length)return null;var s=!0;return Object.keys(o.dataset).forEach(function(u){o.dataset[u]!==n.dataset[u]&&(s=!1)}),s?r:null}function Ee(e){var t=e.url,r=e.attributes,n=e.onSuccess,o=e.onError,s=te(t,r);s.onerror=o,s.onload=n,document.head.insertBefore(s,document.head.firstElementChild)}function we(e){var t=e.environment,r=t==="sandbox"?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js";delete e.environment,e.sdkBaseUrl&&(r=e.sdkBaseUrl,delete e.sdkBaseUrl);var n=e,o=Object.keys(n).filter(function(d){return typeof n[d]<"u"&&n[d]!==null&&n[d]!==""}).reduce(function(d,c){var p=n[c].toString();return c=Ne(c),c.substring(0,4)==="data"||c==="crossorigin"?d.attributes[c]=p:d.queryParams[c]=p,d},{queryParams:{},attributes:{}}),s=o.queryParams,u=o.attributes;return s["merchant-id"]&&s["merchant-id"].indexOf(",")!==-1&&(u["data-merchant-id"]=s["merchant-id"],s["merchant-id"]="*"),{url:"".concat(r,"?").concat(je(s)),attributes:u}}function Ne(e){var t=function(r,n){return(n?"-":"")+r.toLowerCase()};return e.replace(/[A-Z]+(?![a-z])|[A-Z]/g,t)}function je(e){var t="";return Object.keys(e).forEach(function(r){t.length!==0&&(t+="&"),t+=r+"="+e[r]}),t}function te(e,t){t===void 0&&(t={});var r=document.createElement("script");return r.src=e,Object.keys(t).forEach(function(n){r.setAttribute(n,t[n]),n==="data-csp-nonce"&&r.setAttribute("nonce",t["data-csp-nonce"])}),r}function Ae(e,t){if(t===void 0&&(t=Promise),re(e,t),typeof document>"u")return t.resolve(null);var r=we(e),n=r.url,o=r.attributes,s=o["data-namespace"]||"paypal",u=Z(s);return o["data-js-sdk-library"]||(o["data-js-sdk-library"]="paypal-js"),ye(n,o)&&u?t.resolve(u):Re({url:n,attributes:o},t).then(function(){var d=Z(s);if(d)return d;throw new Error("The window.".concat(s," global variable is not available."))})}function Re(e,t){t===void 0&&(t=Promise),re(e,t);var r=e.url,n=e.attributes;if(typeof r!="string"||r.length===0)throw new Error("Invalid url.");if(typeof n<"u"&&typeof n!="object")throw new Error("Expected attributes to be an object.");return new t(function(o,s){if(typeof document>"u")return o();Ee({url:r,attributes:n,onSuccess:function(){return o()},onError:function(){var u=new Error('The script "'.concat(r,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return s(u)}})})}function Z(e){return window[e]}function re(e,t){if(typeof e!="object"||e===null)throw new Error("Expected an options object.");var r=e.environment;if(r&&r!=="production"&&r!=="sandbox")throw new Error('The `environment` option must be either "production" or "sandbox".');if(typeof t<"u"&&typeof t!="function")throw new Error("Expected PromisePonyfill to be a function.")}var Ce=function(e){var t,r=e.options,n=r===void 0?{clientId:"test"}:r,o=e.children,s=e.deferLoading,u=s===void 0?!1:s,d=i.useReducer(Se,{options:f(f({},n),(t={},t[R.DATA_JS_SDK_LIBRARY]=R.DATA_LIBRARY_VALUE,t[R.DATA_SDK_INTEGRATION_SOURCE]=R.DATA_LIBRARY_VALUE,t[D]="".concat(Q(n)),t)),loadingStatus:u?g.INITIAL:g.PENDING}),c=d[0],p=d[1];return i.useEffect(function(){if(u===!1&&c.loadingStatus===g.INITIAL)return p({type:w.LOADING_STATUS,value:g.PENDING});if(c.loadingStatus===g.PENDING){var m=!0;return Ae(c.options).then(function(){m&&p({type:w.LOADING_STATUS,value:g.RESOLVED})}).catch(function(x){console.error("".concat(fe," ").concat(x)),m&&p({type:w.LOADING_STATUS,value:{state:g.REJECTED,message:String(x)}})}),function(){m=!1}}},[c.options,u,c.loadingStatus]),M.createElement(H.Provider,{value:f(f({},c),{dispatch:p})},o)};function $(){}i.createContext({cardFieldsForm:null,fields:{},registerField:$,unregisterField:$});function _e({course:e,user:t,clientId:r,password:n}){console.log(n);const[o,s]=i.useState(""),u={layout:"vertical"},d=({showSpinner:c})=>{const[{isPending:p}]=ee();return a.jsxs(a.Fragment,{children:[c&&p&&a.jsx("div",{className:"spinner"}),a.jsx(W,{style:u,disabled:!1,forceReRender:[u],fundingSource:void 0,createOrder:(m,x)=>x.order.create({purchase_units:[{amount:{currency_code:"MXN",value:e==null?void 0:e.price},reference_id:t.id}]}),onApprove:(m,x)=>x.order.capture().then(v=>{var E;const b={order:{reference_id:v.purchase_units[0].reference_id,amount:v.purchase_units[0].amount,shipping:{address:((E=v.purchase_units[0].shipping)==null?void 0:E.address)||{}},payments:{captures:[{id:v.id,status:v.status,create_time:v.create_time}]}},course:e,password:n},y=document.querySelector('meta[name="csrf-token"]').getAttribute("content");fetch("/paypal/paypal-payment",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":y},body:JSON.stringify(b),credentials:"same-origin"}).then(h=>h.json()).then(h=>{h.success?(console.log("Pago procesado exitosamente"),s(h.message),setTimeout(()=>{window.location.href="/login"},5e3)):console.error("Error en la respuesta del backend:",h)}).catch(h=>{console.error("Error en el procesamiento del pago:",h)})})})]})};return a.jsxs("div",{className:"w-full py-8 px-2 relative",style:{maxWidth:"750px",minHeight:"200px"},children:[a.jsx(Ce,{options:{"client-id":r,components:"buttons",currency:"MXN",locale:"es_MX"},children:a.jsx(d,{showSpinner:!1})}),o&&a.jsxs("div",{className:"mt-4 text-green-800 font-bold flex flex-col items-center",children:[a.jsx(S.Alert,{className:"font-bold w-full text-center mt-2",variant:"filled",color:"green",children:o}),a.jsx("p",{className:"text-center mt-2",children:"Serás redirigido al login ..."})]})]})}function Le(){const[e,t]=i.useState(null);i.useEffect(()=>{const l=localStorage.getItem("selectedCourse");l&&t(JSON.parse(l))},[]),console.log(e);const[r,n]=i.useState(!1),{data:o,setData:s,post:u,processing:d,errors:c,reset:p}=se({name:"",email:"",password:"",password_confirmation:""}),[m,x]=i.useState(0),[v,b]=i.useState(!0),[y,E]=i.useState(!1),[h,_]=i.useState(!1),[N,F]=i.useState(""),[P,q]=i.useState(null),[G,k]=i.useState([]),[I,j]=i.useState("");i.useEffect(()=>{fetch("/paypal-client-id").then(l=>l.json()).then(l=>{q(l.client_id)}).catch(l=>{console.error("Error fetching client ID:",l)})},[]);const T=()=>{m===0&&!y||x(l=>l+1)},K=l=>{l.preventDefault(),u(route("register"),{onSuccess:C=>{E(!0),x(1),k(C.props.user),j(C.props.password)},onFinish:()=>{p("name","email","password","password_confirmation")}})},A=async l=>{try{const C=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),J=await fetch("/check-email",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":C},body:JSON.stringify({email:l})});if(J.status===200){const ae=await J.json();E(!0),n(!0),k(ae.user)}else console.log("Guardando usuario")}catch(C){return console.error("Error en la solicitud:",C),!1}},O=()=>{n(!1)},ne=()=>{_(!0),n(!1),F("El proceso fue cancelado, intentalo de nuevo."),s({name:"",email:"",password:"",password_confirmation:""})};return a.jsxs(ie,{children:[a.jsx(oe,{title:"Register"}),a.jsxs("div",{className:"w-full py-4 px-2 relative",style:{top:"-50px"},children:[a.jsx("meta",{name:"csrf-token",content:"{{ csrf_token() }}"}),a.jsxs(S.Stepper,{activeStep:m,isFirstStep:l=>b(l),children:[a.jsxs(S.Step,{onClick:()=>v&&x(0),className:v?"cursor-pointer":"cursor-not-allowed",children:[a.jsx(pe,{className:`h-5 w-5 ${v?"text-gray-500":"text-gray-400"}`}),a.jsx("div",{className:"absolute -bottom-[2.5rem] w-max text-center",children:a.jsx(S.Typography,{color:m===1?"blue-gray":"gray",className:"font-normal text-sm",children:"Información"})})]}),a.jsxs(S.Step,{onClick:()=>y&&!h&&x(1),className:y&&!h?"cursor-pointer":"cursor-not-allowed",children:[a.jsx(ue,{className:`h-5 w-5 ${y?"text-gray-500":"text-gray-400"}`}),a.jsx("div",{className:"absolute -bottom-[2.5rem] w-max text-center",children:a.jsx(S.Typography,{color:m===1?"blue-gray":"gray",className:"font-normal text-sm",children:"Pago"})})]})]}),m===0&&a.jsxs("div",{className:"mt-2 py-2",children:[a.jsx("br",{}),a.jsxs("form",{onSubmit:K,children:[a.jsxs("div",{className:"mt-4",children:[a.jsx(L,{htmlFor:"email",value:"Correo"}),a.jsx(U,{id:"email",type:"email",name:"email",value:o.email,className:"mt-1 block w-full",autoComplete:"username",isFocused:!0,onBlur:l=>{A(l.target.value)},onChange:l=>{s("email",l.target.value)},required:!0}),a.jsx(B,{message:c.email,className:"mt-2"})]}),a.jsx("br",{}),a.jsxs("div",{children:[a.jsx(L,{htmlFor:"name",value:"Nombre Completo"}),a.jsx(U,{id:"name",name:"name",value:o.name,className:"mt-1 block w-full",autoComplete:"name",onChange:l=>s("name",l.target.value),required:!0}),a.jsx(B,{message:c.name,className:"mt-2"})]}),a.jsx("br",{}),a.jsxs("div",{className:"mt-4",children:[a.jsx(L,{htmlFor:"password",value:"Contraseña"}),a.jsx(U,{id:"password",type:"password",name:"password",value:o.password,className:"mt-1 block w-full",autoComplete:"new-password",onChange:l=>s("password",l.target.value),required:!0}),a.jsx(B,{message:c.password,className:"mt-2"})]}),a.jsx("br",{}),a.jsxs("div",{className:"mt-4",children:[a.jsx(L,{htmlFor:"password_confirmation",value:"Confirmar Contraseña"}),a.jsx(U,{id:"password_confirmation",type:"password",name:"password_confirmation",value:o.password_confirmation,className:"mt-1 block w-full",autoComplete:"new-password",onChange:l=>s("password_confirmation",l.target.value),required:!0}),a.jsx(B,{message:c.password_confirmation,className:"mt-2"})]}),a.jsx("br",{}),a.jsx("div",{className:"flex items-center justify-end mt-4",children:a.jsx(ce,{className:"ms-4",disabled:d,children:"Guardar"})}),N&&a.jsx("div",{className:"mt-4 text-red-800 font-bold flex flex-col items-center",children:a.jsx(S.Alert,{className:"font-bold w-full text-center mt-2",variant:"filled",color:"red",children:N})})]})]}),m===1&&a.jsx("div",{className:"w-full py-8 px-2 relative",children:a.jsxs("div",{className:"w-full py-8 px-2 relative",style:{maxWidth:"750px",minHeight:"200px"},children:[a.jsx("br",{}),a.jsx(_e,{course:e,user:G,clientId:P,password:I})]})})]}),a.jsxs(S.Dialog,{open:r,handler:O,children:[a.jsx(S.DialogHeader,{children:"Usuario encontrado"}),a.jsx(S.DialogBody,{divider:!0,children:"El correo electrónico que ingresaste ya pertenece a un usuario existente. Por favor, continúa con el proceso de pago para acceder.                "}),a.jsxs(S.DialogFooter,{children:[a.jsx(S.Button,{variant:"text",onClick:ne,className:"mr-2 bg-red-500 text-white hover:bg-red-600 focus:outline-none focus:ring-0",children:"Cancelar"}),a.jsx(S.Button,{variant:"gradient",onClick:()=>{E(!0),_(!1),O(),T()},children:"Continuar"})]})]})]})}export{Le as default};
